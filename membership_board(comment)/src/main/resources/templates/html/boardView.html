<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ê²Œì‹œê¸€ ìƒì„¸ë³´ê¸° í˜ì´ì§€</title>
    <link rel="stylesheet" th:href="@{/boardView/boardView.css}">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>
<!--ìƒë‹¨ ê³ ì •ë°”-->
<div class="header">
    <a th:href="@{/board/list}">
        <img th:src="@{/img/logo.png}" alt="pltoo ë¡œê³ " class="logo">
    </a>
    <div class="auth" th:if="${isLogin}">
        <a href="/logout">ë§ˆì´í˜ì´ì§€</a>
        <a href="/logout">ë¡œê·¸ì•„ì›ƒ</a>
    </div>
    <div class="auth" th:if="${!isLogin}">
        <a href="/member/login">ë¡œê·¸ì¸</a>
        <a href="/member/joinNew.html">íšŒì›ê°€ì…</a>
    </div>
</div>

<!--ê²Œì‹œê¸€ ìƒì„¸ë³´ê¸° ë¶€ë¶„-->
<div class="body">
    <h1 th:text="${board.title}" class="boardtitle">ì œëª©ì…ë‹ˆë‹¤.</h1>
    <div class="board-wrapper">
        <div class="boardtitle-information">
            ğŸ‘¤<span th:text="${board.userId}">ë‹‰ë„¤ì„</span>
            ğŸ•˜<span th:text="${#temporals.format(board.createdAt, 'MM.dd')}"></span>
<!--            ğŸ‘€<span th:text="${board.viewCount}">0</span>-->
<!--                <form th:action="@{/board/like/{id}(id=${board.id})}" method="get">-->
<!--                    <input type="hidden" name="searchKeyword" th:value="${searchKeyword}">-->
<!--                    <input type="hidden" name="page" th:value="${page}">-->
<!--                    <button type="submit">ì¢‹ì•„ìš”</button>-->
<!--                </form>-->
            </span>

        </div>
        <div class="menu-wrapper">
            <input type="checkbox" id="menu-toggle">
            <label for="menu-toggle" class="menu-btn">â‹®</label>
            <div class="menu-content">
                <ul>
                    <li><a th:href="@{/board/modify/{id}(id=${board.id})}">ìˆ˜ì •</a></li>
                    <li><a th:href="@{/board/delete/{id}(id=${board.id})}">ì‚­ì œ</a></li>
                    <li><a href="#">ì‹ ê³ </a></li>
                    <li><a href="#">ì°¨ë‹¨</a></li>
                </ul>
            </div>
        </div>
    </div>
    <hr>

    <div class="boardcontent">
        <p th:text="${board.content}">ë‚´ìš©ì´ ë“¤ì–´ê°ˆ ë¶€ë¶„ì…ë‹ˆë‹¤.</p>
    </div>

    <div class="post-buttons">
        <button id="likeButton">ğŸ‘ ì¢‹ì•„ìš”</button>
        <button id="dislikeButton">ğŸ‘ ì‹«ì–´ìš”</button>
    </div>

    <div class="post-navigation">
        <form th:action="@{/board/list}" method="get" style="display:inline">
            <button id="prevButton">ì´ì „ ê¸€</button>
            <input type="hidden" name="searchKeyword" th:value="${searchKeyword}" />
            <input type="hidden" name="page" th:value="${page - 1}" />
        </form>

        <form th:action="@{/board/list}" method="get" style="display:inline">
            <button type="submit">ëª©ë¡</button>
            <input type="hidden" name="searchKeyword" th:value="${searchKeyword}" />
            <input type="hidden" name="page" th:value="${page - 1}" />
        </form>

        <form th:action="@{/board/list}" method="get" style="display:inline">
            <button id="nextButton">ë‹¤ìŒ ê¸€</button>
            <input type="hidden" name="searchKeyword" th:value="${searchKeyword}" />
            <input type="hidden" name="page" th:value="${page + 1}" />
        </form>
    </div>


<!--    ëŒ“ê¸€ ë¦¬ìŠ¤íŠ¸ ë¶€ë¶„-->
    <div id="commentList">
        <!-- ì—¬ê¸°ì— ëŒ“ê¸€ ëª©ë¡ì´ ë™ì ìœ¼ë¡œ ì¶”ê°€ë  ì˜ˆì • -->
    </div>
    <div id="commentStatus"></div>

<!--    ëŒ“ê¸€ ì‘ì„± ë¶€ë¶„-->
        <form id="commentForm">
            <input type="hidden" id="boardId" name="boardId" th:value="${board.id}" placeholder="ê²Œì‹œíŒë²ˆí˜¸" readonly><br><br>
            <!-- ìœ ì € ë²ˆí˜¸ -->
            <input type="hidden" id="memberId" name="memberId" th:value="${memberNum}" placeholder="ë©¤ë²„ë²ˆí˜¸" readonly><br><br>
            <!-- ë‚´ìš© -->
            <textarea name="content" id="content" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea><br>
            <button type="submit">ëŒ“ê¸€ ì‘ì„±</button>
        </form>

</div>
</body>

<script>
    $(document).ready(function (){
        const boardId = $("#boardId").val();

        // ëŒ“ê¸€ ë¦¬ìŠ¤íŠ¸ ì´ˆê¸°í™”
        function loadComments() {
            $.ajax({
                type: "GET",
                url: "/comments/board/" + boardId,
                success: function (response) {

                    // ê¸°ì¡´ ëŒ“ê¸€ ëª©ë¡ ì´ˆê¸°í™”
                    $("#commentList").empty();

                    // ìƒˆë¡œìš´ ëŒ“ê¸€ ëª©ë¡ ì¶”ê°€
                    response.forEach(function (comment) {
                        $("#commentList").append(
                            "<li><strong>" + comment.memberId + "</strong>: " + comment.content + " <em>(" + comment.createdAt + ")</em></li>"
                        );
                    });
                },
                error: function (xhr, status, error) {
                    console.error("ëŒ“ê¸€ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")
                }
            });
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ëŒ“ê¸€ ëª©ë¡ ë¡œë“œ
        loadComments();


        // ëŒ“ê¸€ ì²˜ë¦¬ í•¨ìˆ˜
        $("#commentForm").submit(function(event) {
            event.preventDefault(); // í¼ì˜ê¸°ë³¸ ì œì¶œ ë™ì‘ì„ ë§‰ìŒ

            const formData = {
                boardId:  $("#boardId").val(),
                memberId: $("#memberId").val(),
                content:  $("#content").val()
            // JSONí˜•íƒœë¡œ ì „í•´ì§€ë©° ì´ëŠ” CommentControlloerì—ì„œ commentDTOë¡œ ê°’ì„ ë°›ìœ¼ë¯€ë¡œ CommentDTOì™€ ì»¬ëŸ¼ëª…ì´ ê°™ì•„ì•¼ í•œë‹¤. ê·¸ ë’¤ì—ëŠ” htmlì˜ ê°’ì„ ë°›ì•„ì˜¤ë¯€ë¡œ name ë˜ëŠ”  idì™€ ì´ë¦„ì´ ê°™ì•„ì•¼ í•œë‹¤,
            };

            $.ajax({
                type: "POST",
                url: "/comments",
                contentType: "application/json",
                data: JSON.stringify(formData),
                success: function (response) {
                    // ëŒ“ê¸€ ì¶”ê°€ ì„±ê³µ ì‹œ ì…ë ¥ í¼ ì´ˆê¸°í™”
                    $("#commentStatus").html("<p>" + response + "</p>");
                    $("#content").val("");
                    loadComments(); // ëŒ“ê¸€ ëª©ë¡ ë‹¤ì‹œ ë¡œë“œ
                },
                error: function(xhr, status, error) {
                    $("#commentStatus").html("<p>ì˜¤ë¥˜: " + xhr.responseText + "</p>");
                }
            });
        });
    });

</script>
</html>
